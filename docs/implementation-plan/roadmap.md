# 実装計画ロードマップ

## 📋 プロジェクト概要

### 🎯 目標

日本の確定申告（青色申告）に対応した複式簿記システムを段階的に構築し、最終的には中小企業・個人事業主が簡単に利用できる会計システムを提供する。

**✅ 2025年1月現在**: **フェーズ1完了・フェーズ2進行中** - 基本的な複式簿記システムが完成し、実用機能の実装を進行中

### 🔧 開発方針

- アジャイル開発手法の採用
- 2週間スプリントでの反復開発
- CI/CDパイプラインの早期構築
- テスト駆動開発（TDD）の実践
- 技術的負債の最小化
- **マルチテナント対応**: 複数組織での利用を想定した設計

## 2. フェーズ別実装計画

### ✅ Phase 0: プロジェクト基盤構築（完了）

#### 🎯 目標

開発環境の整備とプロジェクトの基本構造を確立する。

#### ✅ 完了済みタスク

1. **✅ リポジトリセットアップ**

   - ✅ GitHubリポジトリの作成
   - ✅ ブランチ戦略の策定（Git Flow）
   - ✅ コミットメッセージ規約の設定

2. **✅ 開発環境構築**

   - ✅ Docker環境の構築（docker-compose.yml）
   - ✅ 開発用データベースのセットアップ
   - ✅ 環境変数管理（.env.example）
   - ✅ pnpmモノレポ構造

3. **✅ プロジェクト構造**

   - ✅ モノレポ構造の採用（pnpm workspaces）
   - ✅ フロントエンド（Next.js 14 + TypeScript）
   - ✅ バックエンド（Express.js + TypeScript）
   - ✅ 共通型定義の整備（packages/shared）
   - ✅ データベースパッケージ（packages/database）

4. **✅ 品質管理ツール**

   - ✅ ESLint/Prettier設定
   - ✅ Husky + lint-staged
   - ✅ Jest環境構築
   - ✅ TypeScript strict mode

5. **✅ CI環境構築**
   - ✅ GitHub Actions基本設定
   - ✅ 自動テスト実行
   - ✅ 自動lint実行
   - ✅ PRチェック自動化

### ✅ Phase 1: コア機能実装（完了）

#### 🎯 目標

複式簿記の基本機能を実装し、仕訳入力から基本的な帳票出力までを可能にする。

#### ✅ 完了済みタスク

1. **✅ データベース設計**

   - ✅ ER図の作成（docs/specifications/）
   - ✅ Prismaマイグレーション環境構築
   - ✅ 初期テーブル作成
   - ✅ **マルチテナント対応**: Organization、UserOrganization追加
   - ✅ 全エンティティにorganizationId追加

2. **✅ 認証システム**

   - ✅ ユーザー登録・ログイン
   - ✅ JWT認証実装（アクセス・リフレッシュトークン）
   - ✅ 認証ミドルウェア実装
   - ✅ 組織コンテキスト管理

3. **✅ 勘定科目管理**

   - ✅ 日本標準勘定科目マスタ
   - ✅ 勘定科目CRUD API
   - ✅ フロントエンド実装（/demo/accounts）
   - ✅ 検索・フィルタリング機能
   - ✅ 階層構造対応

4. **✅ 仕訳入力機能**

   - ✅ 複式簿記仕訳入力フォーム
   - ✅ 借方・貸方自動バランスチェック
   - ✅ 複数行仕訳対応
   - ✅ 仕訳CRUD API
   - ✅ フロントエンド実装（/demo/journal-entries）
   - ✅ 消費税計算対応

5. **✅ 基本帳票**
   - ✅ 貸借対照表（BS）API
   - ✅ 損益計算書（PL）API
   - ✅ 試算表機能
   - ✅ デモページでの表示確認

### 🔄 Phase 2: 実用機能拡張（進行中）

#### 🎯 目標

日常的な経理業務に必要な機能を追加し、実用レベルまで引き上げる。

#### ✅ 完了済み項目

1. **✅ 決算書作成（基本機能）**

   - ✅ 貸借対照表（BS）- API完成・動作確認済み
   - ✅ 損益計算書（PL）- API完成・動作確認済み
   - ✅ 試算表 - API完成・動作確認済み

2. **✅ 消費税対応（基本機能）**

   - ✅ 税率設定（10%、8%軽減税率）
   - ✅ 税込・税抜計算ロジック実装
   - ✅ 仕訳明細での消費税入力対応

3. **✅ UI/UX改善**
   - ✅ ダッシュボード基本実装
   - ✅ レスポンシブ対応（shadcn/ui使用）
   - ✅ 日本語UIの完全対応

#### 🔄 進行中・未実装項目

1. **🔄 補助簿機能**

   - 🔄 現金出納帳（設計済み、実装待ち）
   - 🔄 預金出納帳（設計済み、実装待ち）
   - 🔄 売掛金・買掛金管理（設計済み、実装待ち）

2. **🔄 決算書作成（詳細機能）**

   - 🔄 青色申告決算書フォーマット対応
   - 🔄 フロントエンドでの帳票表示・印刷
   - 🔄 月次決算機能

3. **🔄 消費税対応（詳細機能）**

   - 🔄 消費税集計レポート
   - 🔄 課税売上割合計算
   - 🔄 簡易課税制度対応

4. **🔄 インポート・エクスポート**

   - 🔄 CSV仕訳インポート
   - 🔄 各種帳票のPDF出力
   - 🔄 Excelエクスポート
   - 🔄 弥生会計形式対応

5. **🔄 UI/UX改善（追加機能）**
   - 🔄 グラフ・チャート表示（Chart.js）
   - 🔄 ダッシュボードウィジェット
   - 🔄 キーボードショートカット

### 📋 Phase 3: 青色申告対応（計画中）

#### 🎯 目標

青色申告特別控除（65万円）の要件を満たす機能を完成させる。

#### 📋 計画中タスク

1. **⏳ 電子帳簿保存法対応**

   - ⏳ データ保存要件の実装
   - ⏳ タイムスタンプ機能
   - ⏳ 検索機能の強化
   - ⏳ 取引データの真実性確保

2. **⏳ e-Tax連携**

   - ⏳ e-Tax形式データ出力
   - ⏳ 申告データ検証機能
   - ⏳ XML形式での出力

3. **⏳ 決算整理機能**

   - ⏳ 決算整理仕訳
   - ⏳ 年度締め処理
   - ⏳ 繰越処理
   - ⏳ 会計期間管理

4. **⏳ 固定資産管理**
   - ⏳ 固定資産台帳
   - ⏳ 減価償却計算
   - ⏳ 償却仕訳自動生成
   - ⏳ 固定資産除却処理

### 🚀 Phase 4: 高度な機能（将来計画）

#### 🎯 目標

経営分析機能や外部連携により、付加価値を高める。

#### 🔮 将来計画タスク

1. **📊 経営分析機能**

   - 🔮 財務指標計算（ROA、ROE、流動比率等）
   - 🔮 前期比較分析
   - 🔮 キャッシュフロー分析
   - 🔮 グラフ・チャート可視化

2. **📈 予算管理**

   - 🔮 予算登録
   - 🔮 予実対比
   - 🔮 差異分析
   - 🔮 予算アラート機能

3. **🔗 外部連携**

   - 🔮 銀行API連携（検討）
   - 🔮 請求書システム連携
   - 🔮 給与計算連携
   - 🔮 freee、マネーフォワード連携検討

4. **📱 モバイル対応**
   - 🔮 PWA実装
   - 🔮 オフライン対応
   - 🔮 プッシュ通知
   - 🔮 モバイル専用UI

### 🌐 Phase 5: 本番環境構築（将来計画）

#### 🎯 目標

本番環境での安定稼働を実現する。

#### 🔮 本番化準備タスク

1. **☁️ インフラ構築**

   - 🔮 クラウド環境選定（AWS/GCP/Azure）
   - 🔮 本番環境構築
   - 🔮 CDパイプライン構築
   - 🔮 コンテナオーケストレーション

2. **🔒 セキュリティ強化**

   - 🔮 セキュリティ監査
   - 🔮 ペネトレーションテスト
   - 🔮 WAF導入
   - 🔮 SSL/TLS証明書管理

3. **⚙️ 運用準備**

   - 🔮 監視システム構築（Sentry、DataDog等）
   - 🔮 自動バックアップ体制
   - 🔮 障害対応手順書
   - 🔮 SLA設定

4. **📚 ドキュメント整備**
   - ✅ 基本ドキュメント完成
   - 🔮 ユーザーマニュアル詳細版
   - 🔮 管理者マニュアル
   - ✅ API仕様書（基本版完成）

## 3. 技術スタック詳細

### 3.1 フロントエンド

- **フレームワーク**: Next.js 14+ (App Router)
- **言語**: TypeScript 5+
- **状態管理**: Zustand
- **UIライブラリ**: Tailwind CSS + shadcn/ui
- **フォーム**: React Hook Form + Zod
- **グラフ**: Chart.js
- **テスト**: Jest + React Testing Library

### 3.2 バックエンド

- **フレームワーク**: Express.js
- **言語**: TypeScript 5+
- **ORM**: Prisma
- **認証**: Passport.js + JWT
- **バリデーション**: Joi
- **テスト**: Jest + Supertest

### 3.3 インフラ

- **データベース**: PostgreSQL 15+
- **キャッシュ**: Redis
- **ファイルストレージ**: AWS S3 / MinIO
- **コンテナ**: Docker + Docker Compose
- **CI/CD**: GitHub Actions
- **APM**: Sentry

## 4. 品質基準

### 4.1 コード品質

- TypeScriptの厳格モード使用
- ESLintルールの遵守
- コードレビュー必須
- 単体テストカバレッジ80%以上

### 4.2 パフォーマンス

- Lighthouse Score 90以上
- API応答時間 200ms以内
- データベースクエリ最適化

### 4.3 セキュリティ

- OWASP Top 10対策
- 定期的な依存関係の更新
- セキュリティヘッダーの実装

## 5. リスク管理

### 5.1 技術的リスク

- **リスク**: 税制改正への対応
- **対策**: モジュール化による柔軟な設計

### 5.2 スケジュールリスク

- **リスク**: 機能追加による遅延
- **対策**: MVP優先、段階的リリース

### 5.3 品質リスク

- **リスク**: 計算精度の問題
- **対策**: 徹底的なテストケース作成

## 📊 現在の達成状況と成功指標

### ✅ Phase 1完了・Phase 2進行中（2025年1月現在）

#### 🔧 開発指標（現在の状況）

- **✅ TypeScript使用率**: 100%（全ファイル）
- **✅ ESLint準拠**: 主要エラーなし
- **✅ 単体テスト**: 基本機能をカバー
- **✅ E2Eテスト**: 主要フローを確認済み
- **✅ ビルド成功率**: 100%（フロントエンド・バックエンド）

#### 🚀 プロダクト指標（現在の状況）

- **✅ デモページ動作**: 100%動作確認済み
- **✅ API応答**: 正常動作確認済み
- **✅ 複式簿記検証**: 借方・貸方バランス検証済み
- **✅ マルチテナント**: 組織ベースデータ分離完了
- **✅ 日本語対応**: 会計用語の正確な日本語化完了
- **✅ 基本帳票API**: BS/PL/試算表のAPI完成
- **✅ 消費税対応**: 基本的な税率計算機能実装済み

### 🎯 今後の成功指標（KPI）

#### 📈 開発指標（目標）

- スプリント完了率: 90%以上
- バグ発生率: 1000行あたり1件以下
- テストカバレッジ: 80%以上
- セキュリティ脆弱性: 0件（Critical/High）

#### 🌟 プロダクト指標（目標）

- ページロード時間: 2秒以内
- システム稼働率: 99.9%以上
- ユーザビリティスコア: 80点以上
- API応答時間: 200ms以内
