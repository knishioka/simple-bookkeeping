# Performance: Optimize E2E test timeouts and execution speed

## ğŸ¯ æ¦‚è¦

E2Eãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ™‚é–“ãŒé•·ãã€é–‹ç™ºåŠ¹ç‡ã‚’ä½ä¸‹ã•ã›ã¦ã„ã¾ã™ã€‚ç‰¹ã«30ç§’ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šãŒå¤šç”¨ã•ã‚Œã¦ãŠã‚Šã€ãƒ†ã‚¹ãƒˆå…¨ä½“ã®å®Ÿè¡Œæ™‚é–“ãŒå¿…è¦ä»¥ä¸Šã«é•·ããªã£ã¦ã„ã¾ã™ã€‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã—ã€ãƒ†ã‚¹ãƒˆã®ä¿¡é ¼æ€§ã‚’ä¿ã¡ãªãŒã‚‰å®Ÿè¡Œæ™‚é–“ã‚’çŸ­ç¸®ã—ã¾ã™ã€‚

## ğŸ” ç¾çŠ¶ã®å•é¡Œç‚¹

### 1. éå‰°ãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š

| ç¾åœ¨ã®è¨­å®š | ä½¿ç”¨ç®‡æ‰€             | å®Ÿéš›ã«å¿…è¦ãªæ™‚é–“ |
| ---------- | -------------------- | ---------------- |
| 30000ms    | E2Eå…¨èˆ¬ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ  | 5000-10000ms     |
| 30000ms    | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œå¾…æ©Ÿ | 2000-3000ms      |
| 30000ms    | ãƒšãƒ¼ã‚¸é·ç§»å¾…æ©Ÿ       | 1000-2000ms      |
| 30000ms    | APIå¿œç­”å¾…æ©Ÿ          | 500-1000ms       |

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒœãƒˆãƒ«ãƒãƒƒã‚¯

```typescript
// âŒ ç¾çŠ¶ã®å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰
test('should load journal entries', async ({ page }) => {
  await page.goto('/journal-entries');
  await page.waitForTimeout(3000); // å›ºå®šå¾…æ©Ÿæ™‚é–“
  await expect(page.locator('table')).toBeVisible({ timeout: 30000 });
});

// âŒ éåŠ¹ç‡ãªå¾…æ©Ÿå‡¦ç†
await page.waitForLoadState('networkidle'); // å…¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åœæ­¢ã¾ã§å¾…æ©Ÿ
await page.waitForTimeout(5000); // è¿½åŠ ã®å›ºå®šå¾…æ©Ÿ
```

### 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®çµ±è¨ˆ

| ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ          | ç¾åœ¨ã®å®Ÿè¡Œæ™‚é–“ | ç†æƒ³çš„ãªå®Ÿè¡Œæ™‚é–“ |
| ----------------------- | -------------- | ---------------- |
| basic.spec.ts           | 45ç§’           | 15ç§’             |
| journal-entries.spec.ts | 120ç§’          | 40ç§’             |
| accounts.spec.ts        | 90ç§’           | 30ç§’             |
| auth.spec.ts            | 60ç§’           | 20ç§’             |
| **åˆè¨ˆ**                | **ç´„8åˆ†**      | **ç´„3åˆ†**        |

## ğŸ’¡ æ¨å¥¨ã•ã‚Œã‚‹è§£æ±ºç­–

### 1. é©åˆ‡ãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š

```typescript
// playwright.config.ts
export default defineConfig({
  timeout: 10000, // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’10ç§’ã«
  expect: {
    timeout: 5000, // ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’5ç§’ã«
  },
  use: {
    actionTimeout: 3000, // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’3ç§’ã«
    navigationTimeout: 5000, // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’5ç§’ã«
  },
});

// ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã§é•·ã„å‡¦ç†ãŒå¿…è¦ãªå ´åˆã®ã¿å€‹åˆ¥è¨­å®š
test('should process large dataset', async ({ page }) => {
  test.setTimeout(20000); // ã“ã®ãƒ†ã‚¹ãƒˆã®ã¿20ç§’
  // ...
});
```

### 2. åŠ¹ç‡çš„ãªå¾…æ©Ÿæˆ¦ç•¥

```typescript
// âœ… è¦ç´ ã®å‡ºç¾ã‚’å¾…ã¤
await page.waitForSelector('[data-testid="journal-table"]', {
  state: 'visible',
  timeout: 5000,
});

// âœ… ç‰¹å®šã®æ¡ä»¶ã‚’å¾…ã¤
await page.waitForFunction(() => document.querySelectorAll('tbody tr').length > 0, {
  timeout: 3000,
});

// âœ… APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¾…ã¤
const responsePromise = page.waitForResponse(
  (response) => response.url().includes('/api/journal-entries') && response.status() === 200,
  { timeout: 3000 }
);
await page.click('[data-testid="load-button"]');
await responsePromise;
```

### 3. ãƒ†ã‚¹ãƒˆã®ä¸¦åˆ—å®Ÿè¡Œ

```typescript
// playwright.config.ts
export default defineConfig({
  workers: process.env.CI ? 2 : 4, // ä¸¦åˆ—å®Ÿè¡Œæ•°ã‚’å¢—ã‚„ã™
  fullyParallel: true, // å®Œå…¨ä¸¦åˆ—å®Ÿè¡Œã‚’æœ‰åŠ¹åŒ–

  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
      testMatch: /.*\.spec\.ts/,
    },
  ],
});
```

### 4. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æœ€é©åŒ–

```typescript
// ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®äº‹å‰æº–å‚™
test.beforeAll(async ({ request }) => {
  // APIã§ç›´æ¥ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ï¼ˆUIã‚’é€šã•ãªã„ï¼‰
  await request.post('/api/test/seed', {
    data: { scenario: 'journal-entries' },
  });
});

// ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
test.afterAll(async ({ request }) => {
  await request.delete('/api/test/cleanup');
});
```

### 5. ã‚»ãƒ¬ã‚¯ã‚¿ã®æœ€é©åŒ–

```typescript
// âŒ é…ã„ã‚»ãƒ¬ã‚¯ã‚¿
await page.locator('div > div > button:has-text("Submit")').click();

// âœ… é«˜é€Ÿãªã‚»ãƒ¬ã‚¯ã‚¿
await page.locator('[data-testid="submit-button"]').click();
await page.locator('#submit-btn').click();
```

## ğŸ“‹ ã‚¢ã‚¯ã‚»ãƒ—ã‚¿ãƒ³ã‚¹ã‚¯ãƒ©ã‚¤ãƒ†ãƒªã‚¢

- [ ] E2Eãƒ†ã‚¹ãƒˆå…¨ä½“ã®å®Ÿè¡Œæ™‚é–“ãŒ50%ä»¥ä¸ŠçŸ­ç¸®ã•ã‚Œã‚‹
- [ ] ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼ã®ç™ºç”Ÿç‡ãŒæ¸›å°‘ã™ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆã®ä¿¡é ¼æ€§ãŒç¶­æŒã•ã‚Œã‚‹ï¼ˆãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆãŒãªã„ï¼‰
- [ ] ä¸¦åˆ—å®Ÿè¡ŒãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- [ ] CI/CDã§ã®å®Ÿè¡Œæ™‚é–“ãŒ5åˆ†ä»¥å†…ã«ãªã‚‹
- [ ] ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒèª­ã¿ã‚„ã™ãä¿å®ˆã—ã‚„ã™ã„

## ğŸ—ï¸ å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

1. **ç¾çŠ¶åˆ†æ**ï¼ˆ1æ—¥ï¼‰
   - å„ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ™‚é–“æ¸¬å®š
   - ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®ç‰¹å®š
   - å¾…æ©Ÿæ™‚é–“ã®åˆ†æ

2. **è¨­å®šã®æœ€é©åŒ–**ï¼ˆ1æ—¥ï¼‰
   - playwright.config.tsã®æ›´æ–°
   - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®èª¿æ•´
   - ä¸¦åˆ—å®Ÿè¡Œã®è¨­å®š

3. **ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**ï¼ˆ3æ—¥ï¼‰
   - å›ºå®šå¾…æ©Ÿæ™‚é–“ã®å‰Šé™¤
   - åŠ¹ç‡çš„ãªå¾…æ©Ÿæˆ¦ç•¥ã®å®Ÿè£…
   - ã‚»ãƒ¬ã‚¯ã‚¿ã®æœ€é©åŒ–

4. **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†ã®æ”¹å–„**ï¼ˆ2æ—¥ï¼‰
   - APIãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿æº–å‚™
   - ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®å…±æœ‰åŒ–
   - ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã®è‡ªå‹•åŒ–

5. **æ¤œè¨¼ã¨èª¿æ•´**ï¼ˆ1æ—¥ï¼‰
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
   - ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆã®ä¿®æ­£
   - CI/CDã§ã®å‹•ä½œç¢ºèª

## â±ï¸ è¦‹ç©ã‚‚ã‚Šå·¥æ•°

- **ç·å·¥æ•°**: 8äººæ—¥
- **å„ªå…ˆåº¦**: Medium ğŸŸ¡
- **å½±éŸ¿åº¦**: é–‹ç™ºåŠ¹ç‡ã¨CI/CDé€Ÿåº¦

## ğŸ·ï¸ ãƒ©ãƒ™ãƒ«

- `performance`
- `testing`
- `medium-priority`
- `developer-experience`

## ğŸ“Š æˆåŠŸæŒ‡æ¨™

- E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“: 8åˆ† â†’ 3åˆ†ä»¥ä¸‹
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼: 90%å‰Šæ¸›
- CI/CDå®Ÿè¡Œæ™‚é–“: 50%çŸ­ç¸®
- ãƒ†ã‚¹ãƒˆæˆåŠŸç‡: 98%ä»¥ä¸Šç¶­æŒ
- ä¸¦åˆ—å®Ÿè¡ŒåŠ¹ç‡: 70%ä»¥ä¸Š

## âš ï¸ ãƒªã‚¹ã‚¯ã¨è€ƒæ…®äº‹é …

- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆçŸ­ç¸®ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒé…ã„ç’°å¢ƒã§ã®å¤±æ•—
- **ä¸¦åˆ—å®Ÿè¡Œã®ç«¶åˆ**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ãƒãƒ¼ãƒˆã®ç«¶åˆ
- **ãƒ†ã‚¹ãƒˆã®ä¿¡é ¼æ€§ä½ä¸‹**: æœ€é©åŒ–ã«ã‚ˆã‚Šè¦‹é€ƒã•ã‚Œã‚‹ãƒã‚°
- **ç’°å¢ƒä¾å­˜**: ãƒ­ãƒ¼ã‚«ãƒ«ã¨CIã§ç•°ãªã‚‹å‹•ä½œ

## ğŸ› ï¸ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ„ãƒ¼ãƒ«

```typescript
// ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®æ¸¬å®š
test.beforeEach(async ({}, testInfo) => {
  console.time(`Test: ${testInfo.title}`);
});

test.afterEach(async ({}, testInfo) => {
  console.timeEnd(`Test: ${testInfo.title}`);
});

// HTMLãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
// playwright.config.ts
export default defineConfig({
  reporter: [
    ['html', { open: 'never' }],
    ['json', { outputFile: 'test-results.json' }],
  ],
});
```

## ğŸ”„ æ®µéšçš„ãªæœ€é©åŒ–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### Phase 1: Quick Winsï¼ˆ1é€±ç›®ï¼‰

- ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®èª¿æ•´
- å›ºå®šå¾…æ©Ÿæ™‚é–“ã®å‰Šé™¤
- æ˜ã‚‰ã‹ã«é•·ã™ãã‚‹ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ä¿®æ­£

### Phase 2: æ§‹é€ çš„æ”¹å–„ï¼ˆ2é€±ç›®ï¼‰

- ä¸¦åˆ—å®Ÿè¡Œã®å°å…¥
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†ã®æ”¹å–„
- ã‚»ãƒ¬ã‚¯ã‚¿ã®æœ€é©åŒ–

### Phase 3: ç¶™ç¶šçš„æ”¹å–„ï¼ˆ3é€±ç›®ä»¥é™ï¼‰

- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
- ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆã®ç‰¹å®šã¨ä¿®æ­£
- æ›´ãªã‚‹æœ€é©åŒ–ã®æ¤œè¨

## ğŸ“š å‚è€ƒè³‡æ–™

- [Playwright Best Practices](https://playwright.dev/docs/best-practices)
- [Playwright Performance Tips](https://playwright.dev/docs/test-parallel)
- [Web Performance Testing](https://web.dev/vitals/)
- [E2E Testing Optimization](https://martinfowler.com/articles/practical-test-pyramid.html#E2eTests)
