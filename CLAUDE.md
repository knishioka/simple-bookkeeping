# CLAUDE.md - AIã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆï¼ˆClaudeï¼‰ãŒæœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ãƒ»ä¿®æ­£ã™ã‚‹éš›ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚ä¸€è²«æ€§ã®ã‚ã‚‹é«˜å“è³ªãªã‚³ãƒ¼ãƒ‰ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦ãã ã•ã„ã€‚

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

- **ç›®çš„**: æ—¥æœ¬ã®å€‹äººäº‹æ¥­ä¸»ãƒ»ä¸­å°ä¼æ¥­å‘ã‘è¤‡å¼ç°¿è¨˜ã‚·ã‚¹ãƒ†ãƒ 
- **æŠ€è¡“**: Next.js 14 (App Router) + TypeScript + Supabase + PostgreSQL
- **æ§‹æˆ**: pnpm workspaceã«ã‚ˆã‚‹ãƒ¢ãƒãƒ¬ãƒ
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: Server Actions ã‚’ä½¿ç”¨ã—ãŸãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### é‡è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
apps/web/                 # Next.js ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (port: 3000)
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ actions/         # Server Actions (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯)
â”‚   â”‚   â”œâ”€â”€ accounts.ts
â”‚   â”‚   â”œâ”€â”€ journal-entries.ts
â”‚   â”‚   â””â”€â”€ reports.ts
â”‚   â”œâ”€â”€ (auth)/         # èªè¨¼ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ dashboard/      # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â””â”€â”€ layout.tsx
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ui/            # shadcn/ui ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â””â”€â”€ lib/
    â””â”€â”€ supabase.ts    # Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

packages/
â”œâ”€â”€ database/          # Prisma ã‚¹ã‚­ãƒ¼ãƒ (@simple-bookkeeping/database)
â””â”€â”€ shared/           # å…±æœ‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (@simple-bookkeeping/shared)

[å»ƒæ­¢äºˆå®š]
apps/api/             # Express.js API (ç§»è¡Œä¸­ã«ã¤ãä½¿ç”¨ç¦æ­¢)
packages/types/       # å‹å®šç¾© (TypeScriptæ¨è«–ã§ä»£æ›¿)
packages/errors/      # ã‚¨ãƒ©ãƒ¼å®šç¾© (Server Actionså†…ã§å®šç¾©)
```

### ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
pnpm dev                     # Next.jsé–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
pnpm --filter web dev        # åŒä¸Šï¼ˆäº’æ›æ€§ã®ãŸã‚æ®‹å­˜ï¼‰

# ãƒ“ãƒ«ãƒ‰
pnpm build                   # å…¨ä½“ãƒ“ãƒ«ãƒ‰
pnpm build:web              # Vercelç”¨Webã‚¢ãƒ—ãƒªãƒ“ãƒ«ãƒ‰

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test                    # å…¨ãƒ†ã‚¹ãƒˆ
pnpm test:e2e               # E2Eãƒ†ã‚¹ãƒˆ
pnpm test:coverage          # ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ

# å•é¡Œã®ã‚ã‚‹ãƒ†ã‚¹ãƒˆã®ç¢ºèª
pnpm test:failing           # å¤±æ•—ã—ãŸ8ã¤ã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
pnpm test:accounting        # ä¼šè¨ˆæœŸé–“ç®¡ç†ã®ãƒ†ã‚¹ãƒˆ
pnpm test:audit            # ç›£æŸ»ãƒ­ã‚°ã®ãƒ†ã‚¹ãƒˆ
pnpm test:demo             # ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆ

# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
pnpm health                 # Web/APIã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ…‹ç¢ºèª
pnpm health:services       # HTTPå¿œç­”ç¢ºèª
# pnpm health:api ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸï¼ˆExpress.js APIå»ƒæ­¢æ¸ˆã¿ï¼‰

# DBæ“ä½œ
pnpm db:init                # DBåˆæœŸåŒ–ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‹ã‚·ãƒ¼ãƒ‰ï¼‰
pnpm db:migrate             # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
pnpm db:studio              # Prisma Studio

# ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç›£è¦–
pnpm deploy:check           # ä¸¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ç¢ºèª
pnpm render:logs runtime    # Renderãƒ­ã‚°ç¢ºèª
pnpm vercel:logs build      # Vercelãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ç¢ºèª
```

è©³ç´°ã¯ [npm-scripts-guide.md](./docs/npm-scripts-guide.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## âš ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç§»è¡Œä¸­ã®æ³¨æ„äº‹é …

### ç¾åœ¨é€²è¡Œä¸­ã®ç§»è¡Œ

**From (ç¾åœ¨):**

# Express.js APIã‚µãƒ¼ãƒãƒ¼ã¯å»ƒæ­¢ã•ã‚Œã¾ã—ãŸ

- Next.js ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Port 3000)
- JWTèªè¨¼
- Prisma ORM

**To (ç§»è¡Œå…ˆ):**

- Next.js Server Actions ã®ã¿
- Supabase (Database + Auth)
- Row Level Security (RLS)
- Edge Functions (å¿…è¦ã«å¿œã˜ã¦)

### å®Ÿè£…æ™‚ã®é‡è¦ãªæŒ‡é‡

1. **æ–°æ©Ÿèƒ½ã¯Server Actionsã§å®Ÿè£…**
   - `/app/actions/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
   - Express.js APIã¯ä½¿ç”¨ã—ãªã„
   - ä¾‹: `app/actions/accounts.ts`

2. **èªè¨¼ã¯Supabaseã‚’ä½¿ç”¨**
   - JWTèªè¨¼ã‚³ãƒ¼ãƒ‰ã¯è¿½åŠ ã—ãªã„
   - `@supabase/ssr` ã‚’ä½¿ç”¨
   - ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®èªè¨¼ãƒã‚§ãƒƒã‚¯

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹**
   - æ–°è¦: Supabase ClientçµŒç”±
   - æ—¢å­˜: Prisma (ç§»è¡Œã¾ã§ã®æš«å®š)

## ğŸ“š è©³ç´°ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è©³ç´°ãªã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã¯ã€ä»¥ä¸‹ã®å°‚é–€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«åˆ†å‰²ã•ã‚Œã¦ã„ã¾ã™ï¼š

### å¿…èª­ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

1. **[ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„](./docs/ai-guide/coding-standards.md)**
   - TypeScript/React ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„
   - Server Actionsè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
   - ã‚³ãƒ¼ãƒ‰å“è³ªã®å³æ ¼ãªãƒ«ãƒ¼ãƒ«
   - Git ã‚³ãƒŸãƒƒãƒˆè¦ç´„

2. **[ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](./docs/ai-guide/security-deployment.md)**
   - æ©Ÿå¯†æƒ…å ±ã®å–ã‚Šæ‰±ã„
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã¨Gitleaks
   - Vercel/Renderãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
   - ãƒ“ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯ã®é‡è¦æ€§

3. **[ãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰](./docs/ai-guide/testing-guide.md)**
   - ãƒ†ã‚¹ãƒˆè¨˜è¿°è¦ç´„
   - E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…ã®æ•™è¨“
   - Pushå‰ã®å¿…é ˆæ‰‹é †
   - ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ã®ç¢ºèªäº‹é …

4. **[ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨å®Ÿè£…ä¾‹](./docs/ai-guide/troubleshooting-examples.md)**
   - ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–
   - GitHub Issue/PRç®¡ç†
   - Server Actionså®Ÿè£…ä¾‹
   - ç¶™ç¶šçš„ãªæ”¹å–„

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ](./docs/architecture/README.md) - ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆã¨ãƒãƒ¼ãƒˆç•ªå·
- [E2Eãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](./docs/testing/e2e/) - E2Eãƒ†ã‚¹ãƒˆã®å®Ÿè£…æ–¹æ³•
- [ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ†ã‚¹ãƒˆ](./docs/user-story-testing-guide.md) - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ†ã‚¹ãƒˆ
- [npmã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸€è¦§](./docs/npm-scripts-guide.md) - npmã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¸€è¦§ã¨èª¬æ˜
- [direnvã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](./docs/direnv-setup.md) - direnvã‚’ä½¿ç”¨ã—ãŸç’°å¢ƒå¤‰æ•°ç®¡ç†
- [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰](./docs/deployment/) - ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰

### APIä»•æ§˜ï¼ˆå»ƒæ­¢äºˆå®šï¼‰

**æ³¨æ„: ä»¥ä¸‹ã®Express.js APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯å»ƒæ­¢äºˆå®šã§ã™ã€‚æ–°è¦å®Ÿè£…ã§ã¯Server Actionsã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚**

- ~~èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `/api/v1/auth/*`~~ â†’ Supabase Auth
- ~~å‹˜å®šç§‘ç›®: `/api/v1/accounts`~~ â†’ Server Actions
- ~~ä»•è¨³: `/api/v1/journal-entries`~~ â†’ Server Actions
- ~~ãƒ¬ãƒãƒ¼ãƒˆ: `/api/v1/reports/*`~~ â†’ Server Actions

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

```bash
# ã‚¹ã‚­ãƒ¼ãƒç¢ºèª
cat packages/database/prisma/schema.prisma

# ERå›³ç”Ÿæˆ
pnpm --filter @simple-bookkeeping/database prisma:studio
```

## ğŸ” æœ€é‡è¦ï¼šæ©Ÿå¯†æƒ…å ±ã®å–ã‚Šæ‰±ã„

### çµ¶å¯¾ã«ã‚³ãƒŸãƒƒãƒˆã—ã¦ã¯ã„ã‘ãªã„ã‚‚ã®

**ä»¥ä¸‹ã®æƒ…å ±ã¯çµ¶å¯¾ã«Gitãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ï¼š**

- APIã‚­ãƒ¼ã€ãƒˆãƒ¼ã‚¯ãƒ³ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¥ç¶šæƒ…å ±
- JWTç§˜å¯†éµ
- OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ
- Vercelãƒˆãƒ¼ã‚¯ãƒ³ã€AWSã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼
- ãã®ä»–ã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æƒ…å ±

**é©åˆ‡ãªç®¡ç†æ–¹æ³•ï¼š**

```bash
# âŒ Bad: ãƒ•ã‚¡ã‚¤ãƒ«ã«ç›´æ¥è¨˜è¼‰
const API_KEY = "sk-1234567890abcdef";

# âœ… Good: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿
const API_KEY = process.env.API_KEY;
```

è©³ç´°ã¯ [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](./docs/ai-guide/security-deployment.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## âš ï¸ Pushå‰ã®å¿…é ˆç¢ºèªäº‹é …

ä»¥ä¸‹ã®æ‰‹é †ã‚’**å¿…ãšé †ç•ªé€šã‚Šã«å®Ÿè¡Œ**ã—ã¦ã‹ã‚‰pushã™ã‚‹ã“ã¨ï¼š

1. **Lint ãƒã‚§ãƒƒã‚¯**

   ```bash
   pnpm lint
   # ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆã¯ä¿®æ­£ã—ã¦ã‹ã‚‰æ¬¡ã¸
   ```

2. **Unit Test å®Ÿè¡Œ**

   ```bash
   pnpm test
   # å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèª
   ```

3. **E2E Test å®Ÿè¡Œï¼ˆçµ¶å¯¾ã«ã‚¹ã‚­ãƒƒãƒ—ã—ãªã„ï¼‰**

   ```bash
   pnpm --filter web test:e2e
   # ãƒ­ãƒ¼ã‚«ãƒ«ã§E2Eãƒ†ã‚¹ãƒˆãŒå…¨ã¦é€šã‚‹ã“ã¨ã‚’ç¢ºèª
   # å¤±æ•—ã—ãŸå ´åˆã¯å¿…ãšä¿®æ­£ã—ã¦ã‹ã‚‰å†å®Ÿè¡Œ
   ```

4. **æœ€çµ‚ãƒ“ãƒ«ãƒ‰ç¢ºèª**
   ```bash
   pnpm build
   # ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
   ```

è©³ç´°ã¯ [ãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰](./docs/ai-guide/testing-guide.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## é‡è¦ãªæ³¨æ„äº‹é …

- **pre-commitãƒ•ãƒƒã‚¯ã‚’ç„¡è¦–ã—ãªã„** - `git commit --no-verify` ã¯å³ç¦
- **ESLintã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–ã—ãªã„** - `// eslint-disable-next-line` ã®å®‰æ˜“ãªä½¿ç”¨ã¯ç¦æ­¢
- **TypeScriptã®anyå‹ã‚’ä½¿ç”¨ã—ãªã„** - å‹å®‰å…¨æ€§ã‚’å¿…ãšä¿ã¤
- **ãƒ†ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ãªã„** - `test.skip` ã‚„ `describe.skip` ã¯ä½¿ç”¨ç¦æ­¢
- **ã‚µãƒ¼ãƒãƒ¼ç®¡ç†** - ä¿®æ­£ãƒ»é–‹ç™ºæ™‚ã¯å¿…ãšã‚µãƒ¼ãƒãƒ¼ã‚’è½ã¨ã™

## important-instruction-reminders

Do what has been asked; nothing more, nothing less.
NEVER create files unless they're absolutely necessary for achieving your goal.
ALWAYS prefer editing an existing file to creating a new one.
NEVER proactively create documentation files (\*.md) or README files. Only create documentation files if explicitly requested by the User.
